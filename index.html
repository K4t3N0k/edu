<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/5.1.3/pixi.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/editor/editor.main.min.css" integrity="sha512-633RnebxsjmF57QUx9c85T6XILSAuJFzKnN5dVsUQ3nsc7c0bW649fCj1Z8ZkAbo5vAHnKZIsGqDokJRiABupA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
    * {
        padding: 0px;
        margin: 0px;
    }
    body {
        background-color: #1E1E1E;
        overflow: hidden;
    }
    .mainContainer {
        margin-left: 10%;
        width: 80%;
        height: 100vh;
        display: flex;
        flex-direction: row;
    }
    .leftContainer {
        flex: 6;
        display: flex;
        flex-direction: column;
    }
    .rightContainer {
        flex: 4;
        display: flex;
        flex-direction: column;
    }
    .leftContainerTop {
        flex-direction: column;
        flex: 4;
        border: 1px solid #383838;
        color: #ffffff;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        padding-left: 24px;
        padding-right: 24px;
    }
    .leftContainerBottom {
        flex-direction: column;
        flex: 10;
        border: 1px solid #383838;
        color: #C6C6C6;
    }
    .rightContainerTop {
        flex: 3;
        border: 1px solid #383838;
        color: #C6C6C6;
        display: flex;
        justify-content: center;
        flex-direction: column-reverse;
        align-items: center;
    }
    .rightContainerBottom {
        flex: 6;
        border: 1px solid #383838;
        color: #ffffff;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        padding-left: 24px;
        padding-right: 24px;
    }
    .buttonSubmit {
        background-color: #608B4E;
        color: #ffffff;
        border: 0px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        font-size: larger;
        width: 100%;
        height: 30px;
        left: 50%;
        top: 100%;
        /* position: relative; */
        /* transform: translate(-50%, -100%); */
    }
    .codeBlock {
        font-family:'Courier New', Courier, monospace;
        background-color: #464646;
        padding-left: 6px;
    }
    .errorBlock {
        font-family:'Courier New', Courier, monospace;
        background-color: #464646;
        color: #ff7070;
        padding-left: 6px;
    }
    </style>
</head>

<body>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/loader.min.js"></script>
    <script>
        require.config({ paths: { 'vs': 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/' }})
        window.MonacoEnvironment = {
          getWorkerUrl: function(workerId, label) {
            return `data:text/javascript;charset=utf-8,${encodeURIComponent(`
              self.MonacoEnvironment = {
                baseUrl: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/'
              };
              importScripts('https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.33.0/min/vs/base/worker/workerMain.min.js');`
            )}`
          }
        }

        let pixiApplication, pixiGraphics

        let editor
        require(["vs/editor/editor.main"], function () {
            const editorContainerElement = document.getElementById("editorContainer")
            editor = monaco.editor.create(editorContainerElement, {
                language: 'javascript',
                theme: 'vs-dark',
                minimap: { enabled: false },
                value: ''
                })
            window.addEventListener('resize', () => { editor.layout() }, false)
        })

        function logError(error) {
            const correctLineNumber = (lineNumber) => { return lineNumber - 3 }
            const logElement = document.getElementById("log")
            logElement.innerHTML = '<p class="errorBlock">line: ' + correctLineNumber(error.lineNumber) + '<br>' + error.name + ": " + error.message + '</p>'
            console.error(error.name, ": ", error.message)
        }

        let testCases = []
        function startTestCases() {

            let isError = false
            let valid = true
            let s = ""
            console.clear()
            for (let i = 0; i < testCases.length; i++) {
                const scriptString = 'try {\n' + editor.getValue() + '\n return test('
                    + JSON.stringify(testCases[i].args[0]).replaceAll('"', '') + ', '
                    + JSON.stringify(testCases[i].args[1]).replaceAll('"', '') + ', '
                    + JSON.stringify(testCases[i].args[2]).replaceAll('"', '')
                    + ') } catch(error) { return error }'

                let functionString
                let result

                try {
                    functionString = Function(`"use strict"; ${scriptString}`)
                } catch (error) {
                    isError = true
                    logError(error)
                    break
                }
                
                try {
                    result = functionString.bind({})()
                    if (result instanceof ReferenceError) {
                        isError = true
                        logError(result)
                        break
                    }
                } catch (error) {
                    isError = true
                    logError(error)
                    break
                }

                const bLog = (key, value) => {
                    if (typeof value === 'number' && !Number.isInteger(value)) {
                        return value.toFixed(4)
                    }
                    return value
                }

                const scale = 30
                pixiGraphics.clear()
                pixiGraphics.lineStyle(1, 0xffffff, 0.15)
                for (let i = -6; i < 6; i++) {
                    pixiGraphics.moveTo(i * scale, -300).lineTo(i * scale, 300)
                    pixiGraphics.moveTo(-300, i * scale).lineTo(300, i * scale)
                }
                pixiGraphics.lineStyle(1, 0xffffff, 0.25)
                pixiGraphics.moveTo(0, -300).lineTo(0, 300)
                pixiGraphics.moveTo(-300, 0).lineTo(300, 0)
                pixiGraphics.x = 150
                pixiGraphics.y = 150

                pixiGraphics.lineStyle(0, 0xffffff, 1)
                pixiGraphics.beginFill(0xffffff, 1).drawCircle(testCases[i].args[0].x * scale, -testCases[i].args[0].y * scale, 2).endFill()
                pixiGraphics.beginFill(0xffffff, 1).drawCircle(testCases[i].args[1].x * scale, -testCases[i].args[1].y * scale, 2).endFill()
                pixiGraphics.beginFill(0xffffff, 1).drawCircle(testCases[i].args[2].x * scale, -testCases[i].args[2].y * scale, 2).endFill()
                pixiGraphics.lineStyle(1, 0xffffff, 1)
                pixiGraphics.moveTo(testCases[i].args[0].x * scale, -testCases[i].args[0].y * scale).lineTo(testCases[i].args[1].x * scale, -testCases[i].args[1].y * scale)
                pixiGraphics.moveTo(testCases[i].args[1].x * scale, -testCases[i].args[1].y * scale).lineTo(testCases[i].args[2].x * scale, -testCases[i].args[2].y * scale)

                pixiGraphics.lineStyle(1, 0x00ffff, 1)
                const p1 = { x: testCases[i].args[0].x - testCases[i].args[1].x, y: testCases[i].args[0].y - testCases[i].args[1].y }
                const p3 = { x: testCases[i].args[2].x - testCases[i].args[1].x, y: testCases[i].args[2].y - testCases[i].args[1].y }
                const deltaAngle = (Math.atan2(p1.y, p1.x) - Math.atan2(p3.y, p3.x)) * 180 / Math.PI

                let startAngle = Math.atan2(p1.x, p1.y) * 180 / Math.PI
                if (startAngle < 0) startAngle += 360


                pixiGraphics.moveTo(testCases[i].args[1].x * scale, -testCases[i].args[1].y * scale)
                pixiGraphics.arc(testCases[i].args[1].x * scale, -testCases[i].args[1].y * scale, 0.5 * scale,
                    (startAngle - 90) * Math.PI / 180,
                    (startAngle + deltaAngle - 90) * Math.PI / 180,
                    false)
                pixiGraphics.closePath()

                if (result !== testCases[i].result) {

                    valid = false
                    console.log((i + 1) + ' ‚ùå test case failed')
                    console.log('input:', testCases[i].args)
                    console.log('output:', result)
                    console.log('expected:', testCases[i].result)

                    s += (i + 1) + ' ‚ùå Test case failed<br>'
                    s += 'input: <p class="codeBlock">p1 = ' + JSON.stringify(testCases[i].args[0], bLog, ' ').replaceAll('"', '') + '</p>'
                    s += '<p class="codeBlock">p2 = ' + JSON.stringify(testCases[i].args[1], bLog, ' ').replaceAll('"', '') + '</p>'
                    s += '<p class="codeBlock">p3 = ' + JSON.stringify(testCases[i].args[2], bLog, ' ').replaceAll('"', '') + '</p>'
                    s += 'output: <p class="codeBlock">\'' + JSON.stringify(result, bLog, ' ').replaceAll('"', '') + '\'</p>'
                    s += 'expected: <p class="codeBlock">\'' + JSON.stringify(testCases[i].result, bLog, ' ').replaceAll('"', '') + '\'</p>'
                    break
                } else {
                    console.log((i + 1) + ' ‚úÖ test case passed')
                    s += `${i + 1} ‚úÖ Test case passed <br>`
                }
            }
            
            if (!isError) {
                if (valid) {
                    console.log('üíö all cases passed')
                    s += 'üíö All cases passed'
                }
                const logElement = document.getElementById("log")
                logElement.innerHTML = s
            }
        }
    
        function init(theme, description, exampleInput, exampleOutput, itestCases, editorValue) {
            const themeElement = document.getElementById('theme')
            themeElement.innerText = theme

            const descriptionElement = document.getElementById('description')
            descriptionElement.innerText = description

            const exampleInputElement = document.getElementById('exampleInput')
            exampleInputElement.innerText = exampleInput
    
            const exampleOutputElement = document.getElementById('exampleOutput')
            exampleOutputElement.innerText = exampleOutput

            testCases = itestCases

            editor.setValue(editorValue)
        }

        window.onload = () => {

            const rightContainerTop = document.getElementById("rightContainerTop")
            pixiApplication = new PIXI.Application({ antialias: true, width: 300, height: 300 })
            // pixiApplication.view.style.
            rightContainerTop.appendChild(pixiApplication.view)
            pixiGraphics = new PIXI.Graphics()
            pixiApplication.stage.addChild(pixiGraphics)


            const theme = '–ì–µ–æ–º–µ—Ç—Ä–∏—è'
            const description = '–ù–∞–π—Ç–∏ —É–≥–æ–ª –º–µ–∂–¥—É –¥–≤—É–º—è –ø—Ä—è–º—ã–º–∏ –∑–∞–¥–∞–Ω–Ω—ã–º–∏ —Ç–æ—á–∫–∞–º–∏ { p1, p2 } –∏ { p2, p3 }.\n–í—ã–≤–µ—Å—Ç–∏ —Ç–∏–ø —É–≥–ª–∞ acute, right, obtuse, straight, reflex, full.'
            const exampleInput = 'p1 = { x: 1, y: 2 }\np2 = { x: 1, y: 0 }\np3 = { x: 3, y: 0 }'
            const exampleOutput = '\'right\''
            const testCases = [
                // acute, right, obtuse, straight, reflex, full.
                {
                    args: [
                        { x: 1, y: 2 },
                        { x: 1, y: 0 },
                        { x: 3, y: 2 },
                    ],
                    result: 'acute'
                },
                {
                    args: [
                        { x: -1-1, y: 1+2 },
                        { x: -1+0, y: 1+0 },
                        { x: -1+2, y: 1+2 },
                    ],
                    result: 'acute'
                },
                {
                    args: [
                        { x: -3, y: -1 },
                        { x: -1, y: 1 },
                        { x: -3, y: 1 },
                    ],
                    result: 'acute'
                },
                {
                    args: [
                        { x: 0, y: 2 },
                        { x: 0, y: 0 },
                        { x: 2, y: 0 },
                    ],
                    result: 'right'
                },
                {
                    args: [
                        { x: -4, y: 0 },
                        { x: 0, y: 0 },
                        { x: 0, y: 2 },
                    ],
                    result: 'right'
                },
                {
                    args: [
                        { x: 1 + (0 * Math.cos(0.5236) - 2 * Math.sin(0.5236)), y: 1 + (0 * Math.sin(0.5236) + 2 * Math.cos(0.5236))},
                        { x: 1 + 0, y: 1 + 0 },
                        { x: 1 + (2 * Math.cos(0.5236) - 0 * Math.sin(0.5236)), y: 1 + (2 * Math.sin(0.5236) + 0 * Math.cos(0.5236))},
                    ],
                    result: 'right'
                },
                {
                    args: [
                        { x: 2, y: 2 },
                        { x: 2, y: 0 },
                        { x: 4, y: -2 },
                    ],
                    result: 'obtuse'
                },
                {
                    args: [
                        { x: -3, y: -1 },
                        { x: -1, y: 1 },
                        { x: 0, y: 3 },
                    ],
                    result: 'obtuse'
                },
                {
                    args: [
                        { x: -2, y: 0 },
                        { x: 0, y: 0 },
                        { x: 2, y: 0 },
                    ],
                    result: 'straight'
                },
                {
                    args: [
                        { x: -1 + (-3 * Math.cos(0.5) - 0 * Math.sin(0.5)), y: 1 + (-3 * Math.sin(0.5) + 0 * Math.cos(0.5))},
                        { x: -1 + 0, y: 1 + 0 },
                        { x: -1 + (2 * Math.cos(0.5) - 0 * Math.sin(0.5)), y: 1 + (2 * Math.sin(0.5) + 0 * Math.cos(0.5))},
                    ],
                    result: 'straight'
                },
                {
                    args: [
                        { x: -3, y: -1 },
                        { x: -1, y: 1 },
                        { x: 1, y: 1.5 },
                    ],
                    result: 'reflex'
                },
                {
                    args: [
                        { x: -3, y: 1 },
                        { x: 1, y: 0 },
                        { x: 1, y: 2 },
                    ],
                    result: 'acute'
                },
                {
                    args: [
                        { x: 0, y: 2 },
                        { x: 0, y: 0 },
                        { x: 0, y: 2 },
                    ],
                    result: 'full'
                },
            ]
            const editorValue = `/**
* @param {{ x: number, y: number }} p1
* @param {{ x: number, y: number }} p2
* @param {{ x: number, y: number }} p3
* @returns {string}
*/
function test(p1, p2, p3) {
    return 'right'
}`
            init(theme, description, exampleInput, exampleOutput, testCases, editorValue)
        }
    </script>

    <div class="mainContainer">
        <div class="leftContainer">
            <div class="leftContainerTop">
                <h2 id="theme">Theme</h2>
                <p id="description">Description</p>
                <br>
                <h2>Example:</h2>
                <p>input: <p class="codeBlock" id="exampleInput">Example Input</p></p>
                <p>output: <p class="codeBlock" id="exampleOutput">Example Output</p></p>
            </div>
            <div class="leftContainerBottom" id="editorContainer">
    
            </div>
        </div>
        <div class="rightContainer">
            <div class="rightContainerTop" id="rightContainerTop">
                <button class="buttonSubmit" onclick="startTestCases()">‚ñ∂</button>
            </div>
            <div class="rightContainerBottom" id="log">
    
            </div>
        </div>
    </div>
</body>

</html>